---
## Author
author:
  name: Митрофанов Тимур Александрович
  degrees: DSc
  orcid: 0000-0002-0877-7063
  email: 1132231842@pfur.ru
  affiliation:
    - name: Российский университет дружбы народов
      country: Российская Федерация
      postal-code: 117198
      city: Москва
      address: ул. Миклухо-Маклая, д. 6

## Title
title: "Лабораторная работа № 16"
subtitle: "Базовая защита от атак типа «brute force»"
license: "CC BY"
---

# Цель работы

Получить навыки работы с программным средством Fail2ban для обеспечения базовой защиты от атак типа «brute force».

# Задание

1. Установите и настройте Fail2ban для отслеживания работы установленных на сервере служб.
2. Проверьте работу Fail2ban посредством попыток несанкционированного доступа с клиента на сервер через SSH.
3. Напишите скрипт для Vagrant, фиксирующий действия по установке и настройке
Fail2ban.



# Выполнение лабораторной работы

На сервере установите fail2ban ([рис. @fig-001])

![Установка fail2ban](image/1.png){#fig-001 width=70%}

Запустите сервер fail2ban([рис. @fig-002])

![Запуск fail2ban](image/2.png){#fig-002 width=70%}

В дополнительном терминале запустите просмотр журнала событий fail2ban  ([рис. @fig-003])

![журнал событий fail2ban](image/3.png){#fig-003 width=70%}

Создайте файл с локальной конфигурацией fail2ban. В файле /etc/fail2ban/jail.d/customisation.local задайте время блокирования на 1 час (время задаётся в секундах) и включите защиту SSH. Перезапустите fail2ban ([рис. @fig-004]).

![базовая настройка fail2ban](image/4.png){#fig-004 width=70%}

Посмотрите журнал событий ([рис. @fig-005]).

![журнал событий fail2ban](image/5.png){#fig-005 width=70%}

В В файле /etc/fail2ban/jail.d/customisation.local включите защиту HTTP.Перезапустите fail2ban([рис. @fig-006]).

![включение защиты HTTP](image/6.png){#fig-006 width=70%}

Посмотрите журнал событий ([рис. @fig-007]).

![журнал событий fail2ban](image/7.png){#fig-007 width=70%}

В файле /etc/fail2ban/jail.d/customisation.local включите защиту почты. Перезапустите fail2ban([рис. @fig-100]).

![Настройка запуска службы на клиенте](image/100.png){#fig-100 width=70%}

Посмотрите журнал событий ([рис. @fig-101])

![журнал событий fail2ban](image/101.png){#fig-101 width=70%}

На сервере посмотрите статус fail2ban. Посмотрите статус защиты SSH в fail2ban. Установите максимальное количество ошибок для SSH, равное 2([рис. @fig-010])

![Доп настройка fail2ban](image/10.png){#fig-010 width=70%}

С клиента попытайтесь зайти по SSH на сервер с неправильным паролем ([рис. @fig-011])

![Пробное подключение с клиента](image/11.png){#fig-011 width=70%}

На сервере посмотрите статус защиты SSH. Убедитесь, что произошла блокировка адреса клиента. Разблокируйте IP-адрес клиента. Вновь посмотрите статус защиты SSH. Убедитесь, что блокировка клиента снята.([рис. @fig-012])

![Снятие бана с клиента](image/12.png){#fig-012 width=70%}

На сервере внесите изменение в конфигурационный файл /etc/fail2ban/jail.d/customisation.local, добавив в раздел по умолчанию игнорирование адреса клиента. Перезапустите fail2ban.([рис. @fig-013])

![Добавление клиента в исключения](image/13.png){#fig-013 width=70%}

Посмотрите журнал событий ([рис. @fig-015])

![журнал событий fail2ban](image/15.png){#fig-015 width=70%}

Вновь попытайтесь войти с клиента на сервер с неправильным паролем ([рис. @fig-016]) и посмотрите статус защиты SSH ([рис. @fig-017]).

![Попытка входа](image/16.png){#fig-016 width=70%}

![Проверка бан-листа](image/17.png){#fig-017 width=70%}

На виртуальной машине server перейдите в каталог для внесения изменений в настройки внутреннего окружения /vagrant/provision/server/, создайте в нём каталог protect, в который поместите в соответствующие подкаталоги конфигурационные файлы. В каталоге /vagrant/provision/server создайте исполняемый файл protect.sh. Открыв его на редактирование, пропишите в нём следующий скрипт. ([рис. @fig-018])

![Внесение изменений в настройки внутреннего окружения виртуальных машин](image/18.png){#fig-018 width=70%}

Для отработки созданного скрипта во время загрузки виртуальной машины server в конфигурационном файле Vagrantfile необходимо добавить в соответствующем разделе конфигураций для сервера ([рис. @fig-019])

![изменение Vagrantfile](image/19.png){#fig-019 width=70%}

# Выводы

Сегодня я получил навыки работы с программным средством Fail2ban для обеспечения базовой защиты от атак типа «brute force».


# Список литературы{.unnumbered}

::: {#refs}
:::
