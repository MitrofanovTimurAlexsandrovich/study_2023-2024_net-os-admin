---
## Author
author:
  name: Митрофанов Тимур Александрович
  degrees: DSc
  orcid: 0000-0002-0877-7063
  email: 1132231842@pfur.ru
  affiliation:
    - name: Российский университет дружбы народов
      country: Российская Федерация
      postal-code: 117198
      city: Москва
      address: ул. Миклухо-Маклая, д. 6

## Title
title: "Лабораторная работа № 12"
subtitle: "Синхронизация времени"
license: "CC BY"
---

# Цель работы

Получение навыков по управлению системным временем и настройке синхронизации времени.

# Задание

1. Изучите команды по настройке параметров времени
2. Настройте сервер в качестве сервера синхронизации времени для локальной сети
3. Напишите скрипты для Vagrant, фиксирующие действия по установке и настройке NTP-сервера и клиента


# Выполнение лабораторной работы

На сервере ([рис. @fig-001]), ([рис. @fig-002]) и клиенте ([рис. @fig-003]) посмотрите параметры настройки даты и времени.

Определите, в какой временной зоне находятся сервер и клиент, проводится ли сетевая синхронизация времени и т.п. Поэкспериментируйте с параметрами этой команды. ---> Временная зона стояла UTC, синхронизациая включина. В качестве эксперементов была изменена временная зона на клиенте и на сервере и заменены на Europe/Moscow

![timedatectl на сервере](image/1.png){#fig-001 width=70%}

![эксперемены с командой и изменение временной зоны на сервере](image/2.png){#fig-002 width=70%}

![timedatectl на клиенте и замена временной зоны](image/3.png){#fig-003 width=70%}

На сервере и клиенте посмотрите текущее системное время ([рис. @fig-004]).

Поэкспериментируйте с параметрами этой команды([рис. @fig-005]).

![Время командой date на сервере и клиенте](image/4.png){#fig-004 width=70%}

![эксперементы с командой date](image/5.png){#fig-005 width=70%}

На сервере и клиенте посмотрите аппаратное время([рис. @fig-006]).

![Просмотр аппаратного времени через hwclock](image/6.png){#fig-006 width=70%}

При необходимости установите на сервере необходимое программное обеспечение и проверьте источники времени на клиенте и на сервере ([рис. @fig-007]).

На основе вывода команды `chronyc sources` можно сделать следующие наблюдения о состоянии синхронизации времени на сервере:


Команда `chronyc sources` отображает список источников (NTP-серверов), с которыми работает демон `chronyd` для синхронизации времени.

---

## **Источники времени**

В таблице представлены 4 источника:

| Символ | Имя/IP адрес        | Стратум | Опрос | Reach | LastRx | Последний сдвиг времени       |
|--------|---------------------|---------|-------|-------|--------|-------------------------------|
| `^_`   | 78.36.199.163       | 2       | 6     | 37    | 54     | -4692 us ± 29 ms              |
| `^*`   | 45.10.245.214       | 2       | 6     | 37    | 59     | -4608 ns ± 8251 us            |
| `^_`   | 83.243.68.157       | 1       | 6     | 37    | 62     | -10 ms ± 14 ms                |
| `^+`   | unspecified.mtw.ru  | 2       | 6     | 77    | 4      | -3076 us ± 7067 us            |

---



- **`^*`** (звездочка) — текущий выбранный источник (используется для синхронизации).
- **`^+`** (плюс) — кандидат на синхронизацию (источник приемлемого качества).
- **`^_`** (подчеркивание) — источник, который был отброшен из-за большой ошибки или недоступности.

- **Текущий источник:** `45.10.245.214` (стратум 2) — выбран как наилучший.
  - Очень маленькое смещение: **-4608 наносекунд** (почти идеально).
  - Погрешность: **±8251 микросекунд** (~8 ms).

- **Альтернативные источники:**
  - `unspecified.mtw.ru` — также является кандидатом (`^+`), смещение -3076 µs.
  - Остальные два (`78.36.199.163` и `83.243.68.157`) отброшены (`^_`), вероятно, из-за большого смещения или вариативности.

- **Stratum** — уровень удаленности от эталонного времени (1 — наивысший).
- **Poll** — интервал опроса (в секундах, 6 ≈ 64 сек).
- **Reach** — история доступности в восьмеричном формате (377 = все последние 8 запросов успешны).
- **LastRx** — время since last received sample (в секундах).
- **Last sample** — последнее измеренное смещение и погрешность.


Система успешно синхронизирована с источником `45.10.245.214`. Хрония работает стабильно, выбранный источник показывает отличные характеристики (минимальное смещение). Остальные источники либо являются резервными, либо были исключены из-за худших показателей.





![Данные о текущей синхронизации времени](image/7.png){#fig-007 width=70%}

На сервере откройте на редактирование файл /etc/chrony.conf и добавьте строку:

allow 192.168.0.0/16

([рис. @fig-008]).

![добавление строки](image/8.png){#fig-008 width=70%}

На сервере перезапустите службу chronyd. Настройте межсетевой экран на сервере ([рис. @fig-009]).

![перезагрузка служб и безопасности](image/9.png){#fig-009 width=70%}

На клиенте откройте файл /etc/chrony.conf и добавьте строку (вместо user укажите свой логин):

server server.user.net iburst

([рис. @fig-010]).

Удалите все остальные строки с директивой server

![изменение файла](image/10.png){#fig-010 width=70%}

На клиенте перезапустите службу chronyd ([рис. @fig-011]).

![Перезагрузка службы](image/11.png){#fig-011 width=70%}

Проверьте источники времени на клиенте ([рис. @fig-013]) и на сервере ([рис. @fig-012]). В отчёте поясните выведенную информацию.

**После изменения настроект клиент началь ореинтироваться на наш серверв в вопросе синхронизации времени!**

Посмотрите подробную информацию о синхронизации и поясните в отчёте выведенную на экран информацию. 

Отчёт по анализу синхронизации времени через chrony на двух серверах:

## 1. Сервер client.tamitrofanov.net

### Источники времени (chronyc sources):
- **5 источников**, все синхронизированы (обозначены символами ^*, ^+)
- **Текущий эталонный источник**: `www.tamitrofanov.net` (обозначен ^*)
- **Дополнительные источники**: 83.167.27.4, time.cloudflare.com, lemonbro.ru, spb-ntp02c.ntppool.yande>

### Статистика синхронизации (chronyc tracking):
- **Reference ID**: C0A80101 (ns.tamitrofanov.net) - указывает на локальный DNS-сервер
- **Stratum**: 4 - четвёртый уровень в иерархии NTP (довольно высокий)
- **Временные показатели**:
  - Системное время отстаёт на 0.000018641 секунд
  - Последнее смещение: +0.000237760 секунд
  - RMS offset: 0.000517579 секунд (среднеквадратичное отклонение)
- **Частота**: 3.824 ppm медленнее эталонной
- **Корневая задержка**: 0.008618812 секунд
- **Статус Leap**: Normal (нормальный)

## 2. Сервер server.tamitrofanov.net

### Источники времени:
- **4 источника**, текущий эталонный: `ntpl.mail.ru` (обозначен ^*)
- **Остальные источники**: vpn-rf.ubnt, 90.188.6.85, vigil.intelfx.name

### Статистика синхронизации:
- **Reference ID**: 5E64B485 (ntpl.mail.ru)
- **Stratum**: 3 - третий уровень (лучше чем на клиенте)
- **Временные показатели**:
  - Системное время опережает на 0.000067075 секунд
  - Последнее смещение: -0.000064430 секунд
  - RMS offset: 0.000891226 секунд
- **Частота**: 6.276 ppm медленнее эталонной
- **Корневая задержка**: 0.008308926 секунд

![изменияем кофиг](image/12.png){#fig-012 width=70%}

![перезапуск служб](image/13.png){#fig-013 width=70%}

На виртуальной машине server перейдите в каталог для внесения изменений
в настройки внутреннего окружения /vagrant/provision/server/, создайте в нём каталог ntp, в который поместите в соответствующие подкаталоги конфигурационные файлы

В каталоге /vagrant/provision/server создайте исполняемый файл ntp.sh ([рис. @fig-014]).

![копирование конфигурации и задание её на сервере](image/14.png){#fig-014 width=70%}

Открыв его на редактирование, пропишите в нём следующий скрипт ([рис. @fig-015]).

![внесение скрипта на сервер](image/15.png){#fig-015 width=70%}

На виртуальной машине client перейдите в каталог для внесения изменений в настройки внутреннего окружения /vagrant/provision/client/, создайте в нём каталог ntp, в который поместите в соответствующие подкаталоги конфигурационные файлы

В каталоге /vagrant/provision/client создайте исполняемый файл ntp.sh ([рис. @fig-016]).

![копирование конфигурации и задание её на клиенте](image/16.png){#fig-016 width=70%}

Открыв его на редактирование, пропишите в нём следующий скрипт ([рис. @fig-017]).

![внесение скрипта на клиент](image/17.png){#fig-017 width=70%}

Для отработки созданных скриптов во время загрузки виртуальных машин server ([рис. @fig-018]) и client ([рис. @fig-019]) в конфигурационном файле Vagrantfile необходимо добавить в соответствующих разделах конфигураций для сервера и клиента.

![настройка бутконфига для сервера](image/18.png){#fig-018 width=70%}

![настройка бутконфига для сервера](image/19.png){#fig-019 width=70%}

# Выводы

Сегодня я получил навыки по управлению системным временем и настройке синхронизации времени.


# Список литературы{.unnumbered}

::: {#refs}
:::
